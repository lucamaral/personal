<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>NodeJS</title>
    <link rel="stylesheet" href="../../lib/reveal/css/reveal.min.css">
    <link rel="stylesheet" href="../../lib/reveal/css/theme/night.css" id="theme">
    <link rel="stylesheet" href="../../lib/highlightjs/styles/tomorrow-night.css">
    <link rel="stylesheet" href="../../stylesheets/main.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h1 class="orange"> Node.js </h1>
                <hr/>
                <h4> Lucas Amaral - <strong class="orange"> 30/10/2014 </strong> </h4>
            </section>
            <section>
                <code class="javascript hljs big-text"><span class="hljs-built_in">console</span>.info(<span class="hljs-string">"Hello node.js!!!"</span>);</code>
            </section>
            <section>
                <ul>
                    <li>2009 por Ryan Dahl</li>
                    <li>Engine Javascript V8 do Google Chrome</li>
                    <li>Non-Blocking-Thread</li>
                    <li>Single-thread</li>
                    <li>Asynchronous & modular programming</li>
                </ul>
            </section>
            <section>
                <h1 class="red"> ExpressJS </h1>
                <h3 class="orange"> Interface RESTFul </h3>
                <h3 class="orange"> MVC </h3>
                <h5 class="orange"> MongoDB usando Mongoose </h5>
            </section>
            <section>
                <section>
                    <ul>
                        <li>Routes</li>
                        <li>Controllers</li>
                        <li>Models</li>
                        <li>Middlewares</li>
                    </ul>
                </section>
                <section>
                    <h3 class="orange"> Routes </h3>
                    <ul>
                        <li> Caminhos do programa </li>
                        <li> API de comunicação com o cliente </li>
                    </ul>
                </section>
                <section>
                    <h3 class="orange"> Controllers </h3>
                    <ul>
                        <li> Regras de negócio </li>
                        <li> Decide o que enviar pro usuário </li>
                    </ul>
                </section>
                <section>
                    <h3 class="orange"> Models </h3>
                    <ul>
                        <li> Estruturas da aplicação </li>
                    </ul>
                </section>
                <section>
                    <h3 class="orange"> Middlewares </h3>
                    <ul>
                        <li> Camadas intermediárias </li>
                        <li> Ex: Validador de sessão do usuário </li>
                    </ul>
                </section>
            </section>
            <section>
                <p>
                    Vamos criar uma pequena rotina de login de usuários! 
                </p>
            </section>
            <section>
                <h3 class="orange"> Primeiro vamos definir algumas coisas... </h3>
            </section>
            <section>
                <ul>
                    <li> - Usuário possui nome e email </li>
                    <li> - Se o usuário existir, ele é redirecionado a página inicial da aplicação </li>
                    <li> - Senão, a aplicação cadastra o novo usuário e redireciona o usuário para página inicial da aplicação </li>
                    <li> - A página inicial da aplicação vai conter o nome e o email do usuário </li>
                    <li> - O usuário poderá fazer logout </li>
                </ul>
            </section>
            <section>
                <section>
                    <h3 class="orange"> Definindo as rotas! </h3>
                </section>
                <section>
                    <ul>
                        <li class="route">
                            <span class="red route-method"> GET </span> 
                            <span class="orange route-path">/</span>
                        </li>
                        <li class="route">
                            <span class="red route-method"> POST </span> 
                            <span class="orange route-path">/login</span>
                        </li>
                        <li class="route">
                            <span class="red route-method"> GET </span> 
                            <span class="orange route-path">/home</span>
                        </li>
                        <li class="route">
                            <span class="red route-method"> GET </span> 
                            <span class="orange route-path">/logout</span>
                        </li>
                    </ul>
                </section>
            </section>
            <section>
                <code class="javascript hljs big-text"><span class="hljs-built_in">console</span>.info(<span class="hljs-string">"Onde está o código?"</span>);</code>
            </section>
            <section>
                <h1 class="red"> NPM </h1>
            </section>
            <section>
                <code class="bash hljs big-text">npm install -g express-generator</code>
            </section>
            <section>
                <pre><code class="bash hljs">express meuProjeto --ejs
<span class="hljs-built_in">cd</span> meuProjeto
npm install</code></pre>
            </section>
            <section>
                <img id="diretorios" src="diretorios.png">
            </section>
            <section>
                <h3 class="red"> package.json </h3>
                <pre><code class="json hljs">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"meuProjeto"</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-string">"0.0.1"</span></span>,
  "<span class="hljs-attribute">description</span>": <span class="hljs-value"><span class="hljs-string">"descrição do meu Projeto"</span></span>,
  "<span class="hljs-attribute">private</span>": <span class="hljs-value"><span class="hljs-literal">false</span></span>,
  "<span class="hljs-attribute">dependencies</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">body-parser</span>": <span class="hljs-value"><span class="hljs-string">"~1.8.1"</span></span>,
    "<span class="hljs-attribute">cookie-parser</span>": <span class="hljs-value"><span class="hljs-string">"~1.3.3"</span></span>,
    "<span class="hljs-attribute">ejs</span>": <span class="hljs-value"><span class="hljs-string">"~0.8.5"</span></span>,
    "<span class="hljs-attribute">express</span>": <span class="hljs-value"><span class="hljs-string">"~4.9.0"</span></span>,
    "<span class="hljs-attribute">express-load</span>": <span class="hljs-value"><span class="hljs-string">"^1.1.14"</span></span>,
    "<span class="hljs-attribute">express-session</span>": <span class="hljs-value"><span class="hljs-string">"^1.9.1"</span></span>,
    "<span class="hljs-attribute">mongoose</span>": <span class="hljs-value"><span class="hljs-string">"^3.8.18"</span>
  </span>}
</span>}
</code></pre>
            </section>
            <section>
                <h3 class="red"> app.js </h3>
                <pre><code class="javascript hljs"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">var</span> load = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express-load"</span>);
<span class="hljs-keyword">var</span> app = express();

app.set(<span class="hljs-string">"views"</span>, __dirname + <span class="hljs-string">"/views"</span>);
app.set(<span class="hljs-string">"view engine"</span>, <span class="hljs-string">"ejs"</span>);
app.use(express.static(__dirname + <span class="hljs-string">"/public"</span>));

load(<span class="hljs-string">"middlewares"</span>)
    .then(<span class="hljs-string">"models"</span>)
    .then(<span class="hljs-string">"controllers"</span>)
    .then(<span class="hljs-string">"routes"</span>)
    .into(app);

app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ 
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Estamos no ar!"</span>); 
});</code></pre>
            </section>
            <section>
                <h3 class="red"> Middlewares/helpers </h3>
                <pre><code class="javascript hljs"><span class="hljs-keyword">var</span> HelpersMiddleware = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(app)</span> </span>{
    <span class="hljs-keyword">const</span> KEY = <span class="hljs-string">"meuProjeto.sid"</span>;
    <span class="hljs-keyword">const</span> SECRET = <span class="hljs-string">"meuProjeto"</span>;
    
    <span class="hljs-keyword">var</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>);
    <span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>);
    <span class="hljs-keyword">var</span> expressSession = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-session'</span>);
    <span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
    <span class="hljs-keyword">var</span> cookie = cookieParser(SECRET);
    <span class="hljs-keyword">var</span> store = <span class="hljs-keyword">new</span> expressSession.MemoryStore();
    
    global.db = mongoose.connect(<span class="hljs-string">"mongodb://localhost/meuProjeto"</span>);
    
    app.use(cookie);
    app.use(expressSession({
        secret: SECRET,
        name: KEY,
        resave: <span class="hljs-literal">true</span>,
        saveUninitialized: <span class="hljs-literal">true</span>,
        store: store
    }));
    app.use(bodyParser.json());
    app.use(bodyParser.urlencoded({
        extended: <span class="hljs-literal">true</span>
    }));
};

<span class="hljs-built_in">module</span>.exports = HelpersMiddleware;</code></pre>
            </section>
            <section>
                <section>
                    <h3 class="red"> Routes/AppRouter </h3>
                    <pre><code class="javascript hljs"><span class="hljs-keyword">var</span> AppRouter = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(app)</span> </span>{
        <span class="hljs-keyword">var</span> AppController = app.controllers.appController;
        <span class="hljs-keyword">var</span> Autenticador = app.middlewares.autenticador;

        app.get(<span class="hljs-string">"/"</span>, AppController.index);
        app.post(<span class="hljs-string">"/login"</span>, AppController.login);
        app.get(<span class="hljs-string">"/home"</span>, Autenticador.autenticar, AppController.home);
        app.get(<span class="hljs-string">"/logout"</span>, AppController.logout);
    };

    <span class="hljs-built_in">module</span>.exports = AppRouter;</code></pre>
                </section>
                <section>
                    <h3 class="red"> Middlewares/Autenticador </h3>
                    <pre><code class="javascript hljs"><span class="hljs-keyword">var</span> Autenticador = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(app)</span></span>{
    <span class="hljs-keyword">return</span> {
        autenticar : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response, next)</span></span>{
            <span class="hljs-keyword">if</span>(request.session.usuario){
                <span class="hljs-keyword">return</span> next(); 
            }
            <span class="hljs-keyword">return</span> response.redirect(<span class="hljs-string">"/"</span>);
        }
    };
};

<span class="hljs-built_in">module</span>.exports = Autenticador;</code></pre>
                </section>
            </section>
            <section>
                <section>
                    <h3 class="red"> Controllers/AppController </h3>
                    <pre><code class="javascript hljs"><span class="hljs-keyword">var</span> AppController = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(app)</span> </span>{
    <span class="hljs-keyword">var</span> Usuario = app.models.usuario;

    <span class="hljs-keyword">return</span> {
        index: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
            <span class="hljs-comment">/* */</span>
        },
        login: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
            <span class="hljs-comment">/* */</span>
        },
        home: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
            <span class="hljs-comment">/* */</span>
        },
        logout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(request, response)</span> </span>{
            <span class="hljs-comment">/* */</span>
        }
    };
};

<span class="hljs-built_in">module</span>.exports = AppController;</code></pre>
                </section>
                <section>
                    <h3 class="red"> Models/Usuario </h3>
                    <pre><code class="javascript hljs"><span class="hljs-keyword">var</span> Usuario = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(app)</span> </span>{
    <span class="hljs-keyword">var</span> Schema = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>).Schema;

    <span class="hljs-keyword">var</span> usuario = Schema({
        nome: {
            type: <span class="hljs-built_in">String</span>,
            required: <span class="hljs-literal">true</span>
        },
        email: {
            type: <span class="hljs-built_in">String</span>,
            required: <span class="hljs-literal">true</span>,
            index: {
                unique: <span class="hljs-literal">true</span>
            }
        }
    });

    <span class="hljs-keyword">return</span> db.model(<span class="hljs-string">"usuarios"</span>, usuario);
};

<span class="hljs-built_in">module</span>.exports = Usuario;</code></pre>
                </section>
            </section>
        </div>
    </div>
    <script data-main="app" src="../../lib/require.js"></script>
</body>

</html>